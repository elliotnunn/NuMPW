
; File: SCSIEqu.a
;
; Version 2.0a3
;
; Copyright Apple Computer, Inc. 1986-1987
; All Rights Reserved
;
;  Equates for SCSI boot, mgr routines
;  SCSI Traps
;________________________________________________________________________________
; Change History:
;
; <A270/27Oct86> SHF	More changes to be eventually rolled into
;						MPW's SCSIEqu.a.  Removed old communication error codes.
; <A300/29Oct86> SHF	Don't need scMacID; using scDefaultID
;						instead (the value 7 instead of 1<<7 [$80]).
; <A370/07Nov86> SHF	Changed SCSITimedSel to SCSISelAtn.
; <C478/10Dec86> SHF	Added new routine selectors and macros.
;	26-feb-87	KLH		selectors agree with Inside Mac, names conflict with Interface.o
;						library exported proc names. Can't include this file there.
;	4-feb-87	KLH		removed SCSIDisconnect, SCSIReselect, SCSIReselAtn.
;________________________________________________________________________________

;  misc SCSI driver equates

scMacID 	EQU    $80			; SCSI ID for Macintosh Plus (bit 7)
SCSIDrvrs	EQU    $B2E 		; (word) bitmap for loaded SCSI drivers 		<27Oct85>

;  SCSI error codes

scCommErr			EQU   2 			; communications error
scBadparmsErr		EQU   4 			; bad parameters passed to driver
scPhaseErr			EQU   5 			; a phase error
scCompareErr		EQU   6 			; data compare error


;---------------------------------------------------
;
;	 the information pertaining to the read/write
;	 command block interpreter.
;
;	 SCSI command block equates.
;

scOpcode		   EQU	 0		; offsets into command "line" for data xfer
scParam1		   EQU	 2
scParam2		   EQU	 6
scSize			   EQU	 10 	; size of a command line


scInc		   EQU	 1			; xfer with address increment
scNoInc 	   EQU	 2			; xfer without address increment
scAdd		   EQU	 3			; add count to address
scMove		   EQU	 4			; MOVE data from addr1 to addr2
scLoop		   EQU	 5			; decrement loop counter and branch
scNop		   EQU	 6			; do very little
scStop		   EQU	 7			; then stop doing even that
scComp		   EQU	 8			; compare bytes with address increment

;
;	 The layout of block 0 of a bootable SCSI device.
;

sbSigWord	   EQU	 $4552			  ; block 0 validator

sbSig		   EQU	 0		  ; signature word
sbBlkSize	   EQU	 2		  ; block size of device
sbBlkCount	   EQU	 4		  ; # blocks on device
sbDevType	   EQU	 8		  ; device type code
sbDevID 	   EQU	 10
sbData		   EQU	 12 	  ; start of data section
sbDrvCount	   EQU	 16 	  ; # drivers following
sbDrvrs 	   EQU	 18 	  ; start of driver descriptors

; Driver descriptors

ddBlock 	   EQU	 0		  ; physical block of driver
ddSize		   EQU	 4		  ; block count of driver
ddType		   EQU	 6		  ; Processor type of driver
ddLen		   EQU	 8

sbMac		   EQU	 1		  ; Macintosh driver type

;
;	The layout of block 1 of a bootable SCSI device.
;
;	 Partition Descriptors
;

pdSigWord	   EQU	 $5453			  ; block 1 validator

pdSig		   EQU	 0

pds 		   EQU	 2
pdStart 	   EQU	 0			  ; starting block of partition
pdSize		   EQU	 4		  ; # blocks in partition
pdFSID		   EQU	 8		  ; File System ID of partition creator (or NIL)
pdLen		   EQU	 12

hfsID		   EQU	 'TFS1' 		  ; The HFS filesystem ID

;Routine Selectors

scsiReset		EQU	0
scsiGet			EQU	1
scsiSelect		EQU	2
scsiCmd			EQU	3
scsiComplete	EQU	4
scsiRead		EQU	5
scsiWrite		EQU	6
scsiRBlind		EQU	8
scsiWBlind		EQU	9
scsiStat		EQU	10

;------------------------------------
;
;	 SCSI Trap definitions.
;

_SCSIDispatch	OPWORD	$A815


	MACRO
	_SCSIReset
	MOVE  #scsiReset,-(sp)
	_SCSIDispatch
	ENDM

	MACRO
	_SCSIGet
	MOVE  #scsiGet,-(sp)
	_SCSIDispatch
	ENDM

	MACRO
	_scsiect
	MOVE  #scsiSelect,-(sp)
	_SCSIDispatch
	ENDM

	MACRO
	_SCSICmd
	MOVE  #scsiCmd,-(sp)
	_SCSIDispatch
	ENDM

	MACRO
	_SCSIComplete
	MOVE  #scsiComplete,-(sp)
	_SCSIDispatch
	ENDM

	MACRO
	_SCSIRead
	MOVE  #scsiRead,-(sp)
	_SCSIDispatch
	ENDM

	MACRO
	_SCSIWrite
	MOVE  #scsiWrite,-(sp)
	_SCSIDispatch
	ENDM

	MACRO
	_SCSIInstall
	MOVE  #scsiInstall,-(sp)
	_SCSIDispatch
	ENDM

	MACRO
	_SCSIRBlind
	MOVE  #scsiRBlind,-(sp)
	_SCSIDispatch
	ENDM

	MACRO
	_SCSIWBlind
	MOVE  #scsiWBlind,-(sp)
	_SCSIDispatch
	ENDM

	MACRO
	_SCSIStat
	MOVE  #scsiStat,-(sp)
	_SCSIDispatch
	ENDM


;************* NEW SCSI EQUATES ********************

;  misc SCSI driver equates

scDefaultID		EQU		7		; default CPU SCSI id (stored in uninitialized PRAM)


;  New SCSI error codes

scArbNBErr		EQU		3		; arbitration timeout waiting for not BSY
scMgrBusyErr	EQU		7		; SCSI Manager busy with another operation
								;	when SCSIGet was called

scSequenceErr	EQU		8		; attempted operation is out of sequence;
								;	e.g., calling SCSISelect before doing
								;	SCSIGet.  Incorrectly written drivers
								;	can cause this error.

scBusTOErr		EQU		9		; CPU bus timeout when attempting read or
								;	write in pseudo-DMA mode -- indicates
								;	that the data wasn't ready within
								;	the 'bus timeout' period.

scComplPhaseErr	EQU		10		; SCSI bus wasn't in Status phase when
								;	SCSIComplete was called -- the SCSI
								;	Manager may have had to throw away data
								;	(or write 'filler' bytes) in order to
								;	reach the Status phase.  Indicates that
								;	the driver didn't clean up after itself.

;
;	New Routine selectors
;

scsiSelAtn			EQU		11
scsiMsgIn			EQU		12
scsiMsgOut			EQU		13

numSelectors		EQU		14

;
;	New SCSI Traps 
;

	MACRO
	_scsiSelAtn
	MOVE	#scsiSelAtn,-(sp)
	_SCSIDispatch
	ENDM

	MACRO
	_SCSIMsgIn
	MOVE	#scsiMsgIn,-(sp)
	_SCSIDispatch
	ENDM

	MACRO
	_SCSIMsgOut
	MOVE	#scsiMsgOut,-(sp)
	_SCSIDispatch
	ENDM
